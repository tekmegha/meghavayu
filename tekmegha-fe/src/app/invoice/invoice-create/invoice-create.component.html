<div class="invoice-create-container">
  <!-- Header -->
  <div class="invoice-header">
    <button class="back-btn" (click)="goBack()">
      <span class="material-icons">arrow_back</span>
    </button>
    <h1>New Bill</h1>
  </div>

  <!-- Main Form -->
  <form [formGroup]="invoiceForm" class="invoice-form">
    <!-- Customer Name -->
    <div class="form-section">
      <input 
        type="text" 
        formControlName="buyerName" 
        class="form-input"
        placeholder="Customer Name"
        [class.error]="invoiceForm.get('buyerName')?.invalid && invoiceForm.get('buyerName')?.touched"
      >
      <button type="button" class="add-customer-btn" (click)="openCustomerModal()">
        <span class="material-icons">person_add</span>
      </button>
    </div>

    <!-- Add Item Row -->
    <div class="form-section">
      <label class="form-label">Add Item</label>
      <div class="add-item-row">
        <input 
          type="text" 
          formControlName="itemDescription" 
          class="item-name-input"
          placeholder="Item name"
        >
        <input 
          type="number" 
          formControlName="quantity" 
          class="qty-input"
          min="1"
          value="1"
          placeholder="Qty"
        >
        <span class="multiply-symbol">×</span>
        <input 
          type="number" 
          formControlName="rate" 
          class="price-input"
          min="0"
          step="0.01"
          placeholder="Price"
        >
        <span class="equals-symbol">=</span>
        <div class="total-display">
          <span class="currency">₹</span>
          <span class="total-value">{{ getItemPrice() | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>

  </form>
 <!-- Added Items Table -->
 <div class="added-items-section" *ngIf="items.length > 0">
  <h3>Invoice Items</h3>
  <div class="items-table">
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Rate</th>
          <th>Amount</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items.controls; let i = index">
          <td>{{ item.get('itemName')?.value }}</td>
          <td>{{ item.get('quantity')?.value }}</td>
          <td>₹{{ item.get('rate')?.value | number:'1.2-2' }}</td>
          <td>₹{{ item.get('amount')?.value | number:'1.2-2' }}</td>
          <td>
            <button 
              type="button" 
              class="btn-remove" 
              (click)="removeItem(i)"
              title="Remove item"
            >
              <span class="material-icons">delete</span>
            </button>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr class="total-row">
          <td colspan="3"><strong>Total:</strong></td>
          <td><strong>₹{{ totalAmount | number:'1.2-2' }}</strong></td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

  <!-- Store Info Display -->
  <div class="store-info-display" *ngIf="hasRequiredStoreData()">
    <div class="store-info-card">
      <h3>Store Information</h3>
      <div class="store-details">
        <div class="store-detail">
          <strong>Store Name:</strong> {{ invoiceForm.get('storeName')?.value }}
        </div>
        <div class="store-detail">
          <strong>Address:</strong> {{ invoiceForm.get('storeAddress')?.value }}
        </div>
        <div class="store-detail">
          <strong>Contact:</strong> {{ invoiceForm.get('storeContact')?.value }}
        </div>
        <div class="store-detail" *ngIf="invoiceForm.get('storeGstin')?.value">
          <strong>GSTIN:</strong> {{ invoiceForm.get('storeGstin')?.value }}
        </div>
      </div>
    </div>
  </div>

  


  <!-- Error Display -->
  <div class="error-message" *ngIf="error">
    <span class="material-icons">error</span>
    {{ error }}
  </div>

  <!-- Sticky Bottom Bar -->
  <div class="sticky-bottom-bar">
    <button 
      type="button" 
      class="btn-add-item" 
      (click)="addCurrentItem()"
      [disabled]="!invoiceForm.get('itemDescription')?.value || !invoiceForm.get('rate')?.value"
    >
      <span class="material-icons">add</span>
      Add Item
    </button>
    <button 
      type="button" 
      class="btn-submit-bottom" 
      (click)="submitInvoice()"
      [disabled]="loading || items.length === 0"
    >
      <span class="material-icons">save</span>
      {{ loading ? 'Saving...' : 'Save Invoice' }}
    </button>
  </div>
</div>

<!-- Customer Details Popup Modal -->
<div class="modal-overlay" *ngIf="showCustomerModal" (click)="closeCustomerModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Customer Details</h3>
      <button class="close-btn" (click)="closeCustomerModal()">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <form [formGroup]="customerForm" class="customer-form">
        <div class="form-row">
          <div class="form-group">
            <label for="customerName">Customer Name *</label>
            <input 
              type="text" 
              id="customerName"
              formControlName="customerName" 
              class="form-control"
              placeholder="Enter customer name"
              [class.error]="customerForm.get('customerName')?.invalid && customerForm.get('customerName')?.touched"
            >
            <div class="error-message" *ngIf="customerForm.get('customerName')?.invalid && customerForm.get('customerName')?.touched">
              Customer name is required
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="customerPhone">Phone Number</label>
            <input 
              type="tel" 
              id="customerPhone"
              formControlName="customerPhone" 
              class="form-control"
              placeholder="Enter phone number"
            >
          </div>
          <div class="form-group">
            <label for="customerEmail">Email</label>
            <input 
              type="email" 
              id="customerEmail"
              formControlName="customerEmail" 
              class="form-control"
              placeholder="Enter email address"
            >
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group full-width">
            <label for="customerAddress">Address</label>
            <textarea 
              id="customerAddress"
              formControlName="customerAddress" 
              class="form-control"
              placeholder="Enter customer address"
              rows="3"
            ></textarea>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="customerGstin">GSTIN (Optional)</label>
            <input 
              type="text" 
              id="customerGstin"
              formControlName="customerGstin" 
              class="form-control"
              placeholder="Enter GSTIN number"
            >
          </div>
          <div class="form-group">
            <label for="customerCity">City</label>
            <input 
              type="text" 
              id="customerCity"
              formControlName="customerCity" 
              class="form-control"
              placeholder="Enter city"
            >
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeCustomerModal()">
        Cancel
      </button>
      <button type="button" class="btn btn-primary" (click)="saveCustomerDetails()" [disabled]="customerForm.invalid">
        <span class="material-icons">save</span>
        Save & Continue
      </button>
    </div>
  </div>
</div>
