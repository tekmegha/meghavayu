<div class="inventory-management-container">
  <div class="header">
    <h2>Inventory Management</h2>
    <button class="btn btn-primary" (click)="addItem()">
      <i class="icon-plus"></i>
      Add Inventory Item
    </button>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <label for="search">Search Items</label>
        <input 
          type="text" 
          id="search" 
          [(ngModel)]="searchTerm"
          placeholder="Search by name, code, or description">
      </div>

      <div class="filter-group">
        <label for="category">Category</label>
        <select id="category" [(ngModel)]="filterCategory">
          <option value="">All Categories</option>
          <option *ngFor="let category of categories" [value]="category.value">
            {{ category.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="status">Status</label>
        <select id="status" [(ngModel)]="filterStatus">
          <option value="all">All Items</option>
          <option value="low">Low Stock</option>
          <option value="out">Out of Stock</option>
          <option value="expired">Expired</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Inventory Form -->
  <div class="inventory-form" *ngIf="isAddingItem || isEditingItem">
    <h3>{{ isAddingItem ? 'Add New Inventory Item' : 'Edit Inventory Item' }}</h3>
    
    <form [formGroup]="inventoryForm" (ngSubmit)="saveItem()">
      <div class="form-row">
        <div class="form-group">
          <label for="item_code">Item Code *</label>
          <input 
            type="text" 
            id="item_code" 
            formControlName="item_code"
            placeholder="e.g., MED001, SUP001"
            [class.error]="inventoryForm.get('item_code')?.invalid && inventoryForm.get('item_code')?.touched">
          <div class="error-message" *ngIf="inventoryForm.get('item_code')?.invalid && inventoryForm.get('item_code')?.touched">
            Item code is required (minimum 3 characters)
          </div>
        </div>

        <div class="form-group">
          <label for="item_name">Item Name *</label>
          <input 
            type="text" 
            id="item_name" 
            formControlName="item_name"
            placeholder="Enter item name"
            [class.error]="inventoryForm.get('item_name')?.invalid && inventoryForm.get('item_name')?.touched">
          <div class="error-message" *ngIf="inventoryForm.get('item_name')?.invalid && inventoryForm.get('item_name')?.touched">
            Item name is required (minimum 2 characters)
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="category">Category *</label>
          <select 
            id="category" 
            formControlName="category"
            [class.error]="inventoryForm.get('category')?.invalid && inventoryForm.get('category')?.touched">
            <option value="">Select Category</option>
            <option *ngFor="let category of categories" [value]="category.value">
              {{ category.label }}
            </option>
          </select>
          <div class="error-message" *ngIf="inventoryForm.get('category')?.invalid && inventoryForm.get('category')?.touched">
            Category is required
          </div>
        </div>

        <div class="form-group">
          <label for="subcategory">Subcategory</label>
          <input 
            type="text" 
            id="subcategory" 
            formControlName="subcategory"
            placeholder="e.g., Antibiotics, Vaccines">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="unit_price">Unit Price *</label>
          <input 
            type="number" 
            id="unit_price" 
            formControlName="unit_price"
            placeholder="Enter unit price"
            min="0"
            step="0.01"
            [class.error]="inventoryForm.get('unit_price')?.invalid && inventoryForm.get('unit_price')?.touched">
          <div class="error-message" *ngIf="inventoryForm.get('unit_price')?.invalid && inventoryForm.get('unit_price')?.touched">
            Valid unit price is required
          </div>
        </div>

        <div class="form-group">
          <label for="quantity_in_stock">Current Stock *</label>
          <input 
            type="number" 
            id="quantity_in_stock" 
            formControlName="quantity_in_stock"
            placeholder="Enter current stock"
            min="0"
            [class.error]="inventoryForm.get('quantity_in_stock')?.invalid && inventoryForm.get('quantity_in_stock')?.touched">
          <div class="error-message" *ngIf="inventoryForm.get('quantity_in_stock')?.invalid && inventoryForm.get('quantity_in_stock')?.touched">
            Valid stock quantity is required
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="minimum_stock_level">Minimum Stock Level *</label>
          <input 
            type="number" 
            id="minimum_stock_level" 
            formControlName="minimum_stock_level"
            placeholder="Enter minimum stock level"
            min="0"
            [class.error]="inventoryForm.get('minimum_stock_level')?.invalid && inventoryForm.get('minimum_stock_level')?.touched">
          <div class="error-message" *ngIf="inventoryForm.get('minimum_stock_level')?.invalid && inventoryForm.get('minimum_stock_level')?.touched">
            Valid minimum stock level is required
          </div>
        </div>

        <div class="form-group">
          <label for="supplier">Supplier</label>
          <input 
            type="text" 
            id="supplier" 
            formControlName="supplier"
            placeholder="Enter supplier name">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="expiry_date">Expiry Date</label>
          <input 
            type="date" 
            id="expiry_date" 
            formControlName="expiry_date">
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          formControlName="description"
          placeholder="Enter item description"
          rows="3"></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="inventoryForm.invalid">
          {{ isAddingItem ? 'Add Item' : 'Update Item' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Inventory List -->
  <div class="inventory-list">
    <div class="inventory-grid">
      <div class="inventory-card" *ngFor="let item of getFilteredItems()">
        <div class="inventory-header">
          <h4>{{ item.item_name }}</h4>
          <div class="stock-status">
            <span class="status-badge" [class]="getStockStatusClass(item)">
              {{ getStockStatus(item) === 'out' ? 'Out of Stock' : 
                 getStockStatus(item) === 'low' ? 'Low Stock' : 'In Stock' }}
            </span>
          </div>
        </div>

        <div class="inventory-details">
          <div class="detail-item">
            <strong>Code:</strong> {{ item.item_code }}
          </div>
          <div class="detail-item">
            <strong>Category:</strong> {{ getCategoryLabel(item.category) }}
          </div>
          <div class="detail-item" *ngIf="item.subcategory">
            <strong>Subcategory:</strong> {{ item.subcategory }}
          </div>
          <div class="detail-item">
            <strong>Unit Price:</strong> â‚¹{{ item.unit_price | number:'1.2-2' }}
          </div>
          <div class="detail-item">
            <strong>Stock:</strong> {{ item.quantity_in_stock }} units
          </div>
          <div class="detail-item">
            <strong>Min Level:</strong> {{ item.minimum_stock_level }} units
          </div>
          <div class="detail-item" *ngIf="item.supplier">
            <strong>Supplier:</strong> {{ item.supplier }}
          </div>
          <div class="detail-item" *ngIf="item.expiry_date">
            <strong>Expiry:</strong> {{ item.expiry_date | date:'mediumDate' }}
          </div>
        </div>

        <div class="inventory-actions">
          <button class="btn btn-sm btn-primary" (click)="editItem(item)">
            <i class="icon-edit"></i>
            Edit
          </button>
          <button class="btn btn-sm btn-secondary" (click)="addTransaction(item)">
            <i class="icon-transaction"></i>
            Transaction
          </button>
          <button class="btn btn-sm btn-secondary" (click)="toggleItemStatus(item)">
            <i class="icon-toggle"></i>
            {{ item.is_active ? 'Deactivate' : 'Activate' }}
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteItem(item)">
            <i class="icon-delete"></i>
            Delete
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="getFilteredItems().length === 0">
      <div class="empty-icon">
        <i class="icon-inventory"></i>
      </div>
      <h3>No Inventory Items</h3>
      <p>Add your first inventory item to start tracking your pet care supplies.</p>
      <button class="btn btn-primary" (click)="addItem()">
        <i class="icon-plus"></i>
        Add Inventory Item
      </button>
    </div>
  </div>

  <!-- Transaction Form -->
  <div class="transaction-form" *ngIf="isAddingTransaction && selectedItem">
    <h3>Add Transaction for {{ selectedItem.item_name }}</h3>
    
    <form [formGroup]="transactionForm" (ngSubmit)="saveTransaction()">
      <div class="form-row">
        <div class="form-group">
          <label for="transaction_type">Transaction Type *</label>
          <select 
            id="transaction_type" 
            formControlName="transaction_type"
            [class.error]="transactionForm.get('transaction_type')?.invalid && transactionForm.get('transaction_type')?.touched">
            <option value="">Select Type</option>
            <option *ngFor="let type of transactionTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
          <div class="error-message" *ngIf="transactionForm.get('transaction_type')?.invalid && transactionForm.get('transaction_type')?.touched">
            Transaction type is required
          </div>
        </div>

        <div class="form-group">
          <label for="quantity">Quantity *</label>
          <input 
            type="number" 
            id="quantity" 
            formControlName="quantity"
            placeholder="Enter quantity"
            min="1"
            [class.error]="transactionForm.get('quantity')?.invalid && transactionForm.get('quantity')?.touched">
          <div class="error-message" *ngIf="transactionForm.get('quantity')?.invalid && transactionForm.get('quantity')?.touched">
            Valid quantity is required
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="unit_price">Unit Price</label>
          <input 
            type="number" 
            id="unit_price" 
            formControlName="unit_price"
            placeholder="Enter unit price"
            min="0"
            step="0.01">
        </div>

        <div class="form-group">
          <label for="notes">Notes</label>
          <input 
            type="text" 
            id="notes" 
            formControlName="notes"
            placeholder="Enter transaction notes">
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="transactionForm.invalid">
          Add Transaction
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
