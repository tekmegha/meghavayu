@if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="store-selector-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Select Store for Delivery</h2>
        <button class="close-btn" (click)="closeModal()">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        @if (isLoading) {
          <div class="loading-state">
            <div class="spinner"></div>
            <p>Loading available stores...</p>
          </div>
        } @else {
          <div class="stores-grid">
            @for (store of deliveryOptions; track store.id) {
              <div 
                class="store-card" 
                [class.selected]="selectedStore?.id === store.id"
                [class.unavailable]="!store.isAvailable"
                (click)="selectStore(store)"
              >
                <div class="store-header">
                  <h3>{{ store.storeName }}</h3>
                  <div class="status-badge" [class]="getStatusColor(store)">
                    {{ getStatusText(store) }}
                  </div>
                </div>

                <div class="store-details">
                  <p class="address">{{ store.storeAddress }}</p>
                  
                  <div class="delivery-info">
                    <div class="info-item">
                      <span class="material-icons">schedule</span>
                      <span>{{ formatTime(store.estimatedTime) }}</span>
                    </div>
                    
                    <div class="info-item">
                      <span class="material-icons">location_on</span>
                      <span>{{ formatDistance(store.distance) }}</span>
                    </div>
                    
                    <div class="info-item">
                      <span class="material-icons">local_shipping</span>
                      <span>â‚¹{{ store.deliveryFee }}</span>
                    </div>
                  </div>
                </div>

                @if (store.isAvailable) {
                  <button class="select-btn" (click)="selectStore(store)">
                    Select Store
                  </button>
                } @else {
                  <button class="select-btn unavailable" disabled>
                    Store Closed
                  </button>
                }
              </div>
            }
          </div>

          @if (deliveryOptions.length === 0) {
            <div class="no-stores">
              <span class="material-icons">store</span>
              <h3>No stores available</h3>
              <p>Please try again later or contact support.</p>
            </div>
          }
        }
      </div>
    </div>
  </div>
}
